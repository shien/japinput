# Phase 1: ローマ字→かな変換の完成

## 目標

ローマ字入力からひらがな・カタカナを正確に生成できる変換エンジンを完成させる。
CLI ツール (`cargo run`) で対話的に動作確認できる状態にする。

## 現在の状態

- `src/romaji.rs` に `convert()` 関数が実装済み
- 基本的な五十音、濁音、半濁音、拗音、促音、「ん」処理が動作
- 32 テストがパス

## タスク

### 1.1 変換テーブルの拡充

- [ ] 小文字かな: `xa`→`ぁ`, `xi`→`ぃ`, `xu`→`ぅ`, `xe`→`ぇ`, `xo`→`ぉ`
- [ ] 小文字かな: `xya`→`ゃ`, `xyu`→`ゅ`, `xyo`→`ょ`, `xtu`→`っ`, `xwa`→`ゎ`
- [ ] `la`→`ぁ` 系 (`l` を `x` の別名として)
- [ ] `dya/dyu/dyo` → `ぢゃ/ぢゅ/ぢょ`
- [ ] `fa/fi/fe/fo` → `ふぁ/ふぃ/ふぇ/ふぉ`
- [ ] `va/vi/vu/ve/vo` → `ゔぁ/ゔぃ/ゔ/ゔぇ/ゔぉ`
- [ ] 長音記号: `-` → `ー`
- [ ] 句読点: `,`→`、`, `.`→`。`
- [ ] 各エントリに対応するテスト追加

**動作確認:**
- `cargo test` で追加した変換テーブルのテストが全てパスすること
- 既存テスト（32件）が引き続きパスすること

### 1.2 ひらがな→カタカナ変換

- [ ] `to_katakana()` 関数: ひらがな文字列をカタカナに変換
- [ ] Unicode コードポイントのオフセット方式 (U+3041〜U+3096 → U+30A1〜U+30F6)
- [ ] テスト: 基本変換、長音記号の保持、混在文字列

**動作確認:**
- `cargo test` で `to_katakana` 関連テストがパスすること
- 長音記号 `ー` やASCII文字がそのまま保持されることをテストで確認

### 1.3 入力状態管理

- [ ] `InputState` 構造体: バッファと変換モードを保持
  - `feed_char(ch)`: 1文字入力
  - `flush()`: 未確定バッファを確定（末尾の `n` → `ん`）
  - `reset()`: バッファをクリア
- [ ] 現在の `convert()` をバッチ用として残しつつ、逐次入力をサポート
- [ ] テスト: 逐次入力のシーケンス、flush 動作、reset 動作

**動作確認:**
- `cargo test` で `InputState` のユニットテストがパスすること
- 逐次入力で `feed_char` を連続呼び出しした結果が `convert()` のバッチ結果と一致することをテストで確認

### 1.4 CLI デモ

- [ ] `src/main.rs` (もしくは `examples/demo.rs`) に対話的デモを追加
- [ ] stdin からローマ字を読み、変換結果を stdout に出力
- [ ] Ctrl+C で終了

**動作確認:**
- `cargo run` (または `cargo run --example demo`) を実行し、ローマ字を入力してかな出力が返ることを手動確認
- `cargo build` がエラーなく完了すること

## 完了条件

- `cargo test` で全テストがパスする
- `cargo run` (または `cargo run --example demo`) でローマ字入力→かな出力を確認できる
- カタカナ変換が動作する

## ファイル構成 (予定)

```
src/
├── lib.rs          # mod 宣言
├── romaji.rs       # ローマ字→ひらがな変換 (拡充)
├── katakana.rs     # ひらがな→カタカナ変換
├── input_state.rs  # 入力状態管理
└── main.rs         # CLI デモ (or examples/demo.rs)
```
